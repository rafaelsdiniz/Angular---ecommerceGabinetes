<div class="page-container">
  <div class="form-container">
    <div class="form-header">
      <button mat-icon-button class="back-btn" (click)="cancelar()">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h2 class="form-title">{{ isEdicao ? 'Editar Cliente' : 'Novo Cliente' }}</h2>
    </div>

    <div *ngIf="carregando" class="loading-state">
      <mat-spinner diameter="48"></mat-spinner>
    </div>

    <div *ngIf="!carregando" class="form-card">
      <form (ngSubmit)="salvar()" #clienteForm="ngForm" novalidate>
        
        <div class="form-section">
          <h3 class="section-title">Dados Pessoais</h3>
          
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Nome</mat-label>
            <input 
              matInput 
              type="text" 
              [(ngModel)]="cliente.nome" 
              name="nome" 
              required
              placeholder="Nome completo">
            <mat-icon matPrefix>person</mat-icon>
            <mat-error *ngIf="clienteForm.submitted && !cliente.nome">
              Campo obrigatório
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Email</mat-label>
            <input 
              matInput 
              type="email" 
              [(ngModel)]="cliente.email" 
              name="email" 
              required
              placeholder="email@exemplo.com">
            <mat-icon matPrefix>email</mat-icon>
            <mat-error *ngIf="clienteForm.submitted && !cliente.email">
              Campo obrigatório
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Telefone</mat-label>
            <input 
              matInput 
              type="tel" 
              [(ngModel)]="cliente.telefone" 
              name="telefone" 
              required
              placeholder="(11) 9999-9999">
            <mat-icon matPrefix>phone</mat-icon>
            <mat-error *ngIf="clienteForm.submitted && !cliente.telefone">
              Campo obrigatório
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>CPF</mat-label>
            <input 
              matInput 
              type="text" 
              [(ngModel)]="cliente.cpf" 
              name="cpf" 
              required
              placeholder="000.000.000-00">
            <mat-icon matPrefix>card_giftcard</mat-icon>
            <mat-error *ngIf="clienteForm.submitted && !cliente.cpf">
              Campo obrigatório
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Adicionado campo de Perfil para identificar admin ou cliente -->
        <div class="form-section">
          <h3 class="section-title">Perfil de Acesso</h3>
          
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Perfil</mat-label>
            <mat-select [(ngModel)]="cliente.perfil" name="perfil" required>
              <mat-option value="CLIENTE">Cliente</mat-option>
              <mat-option value="ADMIN">Administrador</mat-option>
            </mat-select>
            <mat-icon matPrefix>security</mat-icon>
            <mat-hint>Defina o nível de acesso do cliente</mat-hint>
          </mat-form-field>
        </div>

        <div class="form-section">
          <h3 class="section-title">Endereços</h3>
          
          <div class="add-address-btn-container">
            <button 
              mat-button
              type="button" 
              (click)="adicionarEndereco()"
              class="add-btn">
              <mat-icon>add_circle_outline</mat-icon>
              Adicionar Endereço
            </button>
          </div>

          <div *ngFor="let endereco of cliente.enderecos; let i = index" class="endereco-card">
            <div class="endereco-header">
              <h4>Endereço {{ i + 1 }}</h4>
              <button 
                mat-icon-button 
                type="button" 
                (click)="removerEndereco(i)"
                class="delete-endereco-btn">
                <mat-icon>delete_outline</mat-icon>
              </button>
            </div>

            <div class="endereco-grid">
              <mat-form-field appearance="outline">
                <mat-label>Estado</mat-label>
                <input matInput [(ngModel)]="endereco.estado" [name]="'estado-' + i" />
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Cidade</mat-label>
                <input matInput [(ngModel)]="endereco.cidade" [name]="'cidade-' + i" />
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Bairro</mat-label>
                <input matInput [(ngModel)]="endereco.bairro" [name]="'bairro-' + i" />
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>CEP</mat-label>
                <input matInput [(ngModel)]="endereco.cep" [name]="'cep-' + i" />
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Número</mat-label>
                <input matInput [(ngModel)]="endereco.numero" [name]="'numero-' + i" />
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Complemento</mat-label>
                <input matInput [(ngModel)]="endereco.complemento" [name]="'complemento-' + i" />
              </mat-form-field>
            </div>
          </div>

          <div *ngIf="!cliente.enderecos || cliente.enderecos.length === 0" class="empty-addresses">
            Nenhum endereço adicionado
          </div>
        </div>

        <div *ngIf="erro" class="error-alert">
          <mat-icon>error_outline</mat-icon>
          <span>{{ erro }}</span>
        </div>

        <div class="form-actions">
          <button 
            mat-stroked-button 
            type="button" 
            class="cancel-btn" 
            (click)="cancelar()"
            [disabled]="salvando">
            Cancelar
          </button>
          <button 
            mat-flat-button 
            type="submit" 
            class="save-btn"
            [disabled]="salvando">
            <mat-spinner *ngIf="salvando" diameter="20" class="btn-spinner"></mat-spinner>
            <span *ngIf="!salvando">{{ isEdicao ? 'Salvar' : 'Criar' }}</span>
            <span *ngIf="salvando">Salvando...</span>
          </button>
        </div>

      </form>
    </div>
  </div>
</div>
